<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puntos de Ayuda - CaminoSeguro</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg viewBox='0 0 48 48' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M13.8261 17.4264C16.7203 18.1174 20.2244 18.5217 24 18.5217C27.7756 18.5217 31.2797 18.1174 34.1739 17.4264C36.9144 16.7722 39.9967 15.2331 41.3563 14.1648L24.8486 40.6391C24.4571 41.267 23.5429 41.267 23.1514 40.6391L6.64374 14.1648C8.00331 15.2331 11.0856 16.7722 13.8261 17.4264Z' fill='%230d59f2'/%3E%3C/svg%3E">
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAqtKZCjE5tlwCDPMJVEjUBCw278DfEFcc&libraries=places"></script>
</head>
<body>
    <div class="relative flex h-auto min-h-screen w-full flex-col bg-slate-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
      <div class="layout-container flex h-full grow flex-col">
        <!-- Header -->
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#e6edf4] px-10 py-3">
          <a href="../index.html" class="flex items-center gap-2 text-[#0c151d]">
            <img src="../imagenes/logoconnombre.jpeg" alt="CaminoSeguro" class="h-10 object-contain">
          </a>
          <div class="flex items-center gap-4">
            <span id="userName" class="text-[#4574a1] text-sm"></span>
            <button onclick="auth.logout()" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#e6edf4] text-[#0c151d] text-sm font-bold leading-normal tracking-[0.015em] hover:bg-[#ced7e8] transition-colors">
              <span class="truncate">Cerrar Sesión</span>
            </button>
          </div>
        </header>

        <div class="flex flex-1">
          <!-- Sidebar -->
          <nav class="w-64 bg-white border-r border-[#e6edf4] p-4">
            <ul class="space-y-2">
              <li>
                <a href="dashboard.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-[#4574a1] hover:bg-[#e6edf4] transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,160H40V56H216V200ZM184,96a8,8,0,0,1-8,8H80a8,8,0,0,1,0-16h96A8,8,0,0,1,184,96Zm0,32a8,8,0,0,1-8,8H80a8,8,0,0,1,0-16h96A8,8,0,0,1,184,128Zm0,32a8,8,0,0,1-8,8H80a8,8,0,0,1,0-16h96A8,8,0,0,1,184,160Z"/></svg>
                  Dashboard
                </a>
              </li>
              <li>
                <a href="reportes.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-[#4574a1] hover:bg-[#e6edf4] transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm-8-80V80a8,8,0,0,1,16,0v56a8,8,0,0,1-16,0Zm20,36a12,12,0,1,1-12-12A12,12,0,0,1,140,172Z"/></svg>
                  Reportes
                </a>
              </li>
              <li>
                <a href="rutas-seguras.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-[#4574a1] hover:bg-[#e6edf4] transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M200,224H150.54A266.56,266.56,0,0,0,174,200.25c27.45-31.57,42-64.85,42-96.25a88,88,0,0,0-176,0c0,31.4,14.51,64.68,42,96.25A266.56,266.56,0,0,0,105.46,224H56a8,8,0,0,0,0,16H200a8,8,0,0,0,0-16ZM56,104a72,72,0,0,1,144,0c0,57.23-55.47,105-72,118C111.47,209,56,161.23,56,104Zm112,0a40,40,0,1,0-40,40A40,40,0,0,0,168,104Zm-64,0a24,24,0,1,1,24,24A24,24,0,0,1,104,104Z"/></svg>
                  Rutas Seguras
                </a>
              </li>
              <li>
                <a href="mapas-calor.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-[#4574a1] hover:bg-[#e6edf4] transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M128,16a88.1,88.1,0,0,0-88,88c0,75.3,80,132.17,83.41,134.55a8,8,0,0,0,9.18,0C136,236.17,216,179.3,216,104A88.1,88.1,0,0,0,128,16Zm0,206c-16.53-13-72-60.75-72-118a72,72,0,0,1,144,0C200,161.23,144.53,209,128,222Z"/></svg>
                  Mapas de Calor
                </a>
              </li>
              <li>
                <a href="puntos-ayuda.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-[#e6edf4] text-[#0c151d] font-medium">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"/></svg>
                  Puntos de Ayuda
                </a>
              </li>
              <li>
                <a href="educacion.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-[#4574a1] hover:bg-[#e6edf4] transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M251.76,88.94l-120-64a8,8,0,0,0-7.52,0l-120,64a8,8,0,0,0,0,14.12L32,117.87v48.42a15.91,15.91,0,0,0,4.06,10.65C49.16,191.53,78.51,216,128,216a130,130,0,0,0,48-8.76V240a8,8,0,0,0,16,0V199.51a115.63,115.63,0,0,0,27.94-22.57A15.91,15.91,0,0,0,224,166.29V117.87l27.76-14.81a8,8,0,0,0,0-14.12ZM128,200c-43.27,0-68.72-21.14-80-33.71V126.4l76.24,40.66a8,8,0,0,0,7.52,0L176,143.47v46.34C163.4,195.69,147.52,200,128,200Zm80-33.75a97.83,97.83,0,0,1-16,14.25V134.93l16-8.53ZM188,118.94l-.22-.13-56-29.87a8,8,0,0,0-7.52,14.12L171,128l-43,22.93L25,96,128,41.07,231,96Z"/></svg>
                  Educación Preventiva
                </a>
              </li>
            </ul>
          </nav>

          <!-- Main Content -->
          <main class="flex-1 flex">
            <!-- Points List -->
            <div class="w-96 bg-white border-r border-[#e6edf4] overflow-y-auto">
              <div class="p-4 border-b border-[#e6edf4]">
                <h1 class="text-[#0c151d] text-xl font-bold mb-4">Puntos de Ayuda</h1>
                
                <!-- Filters -->
                <div class="flex gap-2 mb-4 overflow-x-auto">
                  <button onclick="filterPoints('all')" id="btnAll" class="px-3 py-1.5 rounded-full bg-[#0c151d] text-white text-xs font-medium whitespace-nowrap">
                    Todos
                  </button>
                  <button onclick="filterPoints('policia')" id="btnPolicia" class="px-3 py-1.5 rounded-full bg-[#e6edf4] text-[#0c151d] text-xs font-medium whitespace-nowrap hover:bg-[#ced7e8]">
                    Policía
                  </button>
                  <button onclick="filterPoints('serenazgo')" id="btnSerenazgo" class="px-3 py-1.5 rounded-full bg-[#e6edf4] text-[#0c151d] text-xs font-medium whitespace-nowrap hover:bg-[#ced7e8]">
                    Serenazgo
                  </button>
                  <button onclick="filterPoints('bomberos')" id="btnBomberos" class="px-3 py-1.5 rounded-full bg-[#e6edf4] text-[#0c151d] text-xs font-medium whitespace-nowrap hover:bg-[#ced7e8]">
                    Bomberos
                  </button>
                  <button onclick="filterPoints('hospital')" id="btnHospital" class="px-3 py-1.5 rounded-full bg-[#e6edf4] text-[#0c151d] text-xs font-medium whitespace-nowrap hover:bg-[#ced7e8]">
                    Hospitales
                  </button>
                </div>
                
                <!-- Search -->
                <div class="relative">
                  <input
                    type="text"
                    id="searchPoints"
                    placeholder="Buscar punto de ayuda..."
                    class="w-full rounded-lg text-[#0c151d] border-none bg-[#e6edf4] h-10 pl-10 pr-4 text-sm placeholder:text-[#4574a1]"
                  />
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#4574a1" viewBox="0 0 256 256" class="absolute left-3 top-1/2 -translate-y-1/2"><path d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z"/></svg>
                </div>
              </div>
              
              <!-- Points List -->
              <div id="pointsList" class="divide-y divide-[#e6edf4]">
                <!-- Comisarías -->
                <div class="p-4 hover:bg-[#f8fafc] cursor-pointer transition-colors" data-type="policia">
                  <div class="flex items-start gap-3">
                    <div class="bg-blue-100 p-2 rounded-lg flex-shrink-0">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#3b82f6" viewBox="0 0 256 256"><path d="M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,120,47.65,76,128,32l80.35,44Zm8,99.64V133.83l72-39.5v85.76Z"/></svg>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="text-[#0c151d] font-medium text-sm">Comisaría San Isidro</h3>
                      <p class="text-[#4574a1] text-xs mt-1">Av. Arequipa 2245, San Isidro</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full">Abierto 24h</span>
                        <span class="text-xs text-[#4574a1]">0.5 km</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="p-4 hover:bg-[#f8fafc] cursor-pointer transition-colors" data-type="serenazgo">
                  <div class="flex items-start gap-3">
                    <div class="bg-green-100 p-2 rounded-lg flex-shrink-0">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#22c55e" viewBox="0 0 256 256"><path d="M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,120,47.65,76,128,32l80.35,44Zm8,99.64V133.83l72-39.5v85.76Z"/></svg>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="text-[#0c151d] font-medium text-sm">Serenazgo Miraflores</h3>
                      <p class="text-[#4574a1] text-xs mt-1">Av. José Larco 1150, Miraflores</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full">Abierto 24h</span>
                        <span class="text-xs text-[#4574a1]">1.2 km</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="p-4 hover:bg-[#f8fafc] cursor-pointer transition-colors" data-type="bomberos">
                  <div class="flex items-start gap-3">
                    <div class="bg-red-100 p-2 rounded-lg flex-shrink-0">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#ef4444" viewBox="0 0 256 256"><path d="M173.79,51.48a221.25,221.25,0,0,0-41.67-34.34,8,8,0,0,0-8.24,0A221.25,221.25,0,0,0,82.21,51.48C54.59,90.49,40,132.73,40,176a88,88,0,0,0,176,0C216,132.73,201.41,90.49,173.79,51.48ZM96,184c0-27.67,22.53-47.28,32-54.3,9.48,7,32,26.63,32,54.3a32,32,0,0,1-64,0Zm77.27,15.93A47.8,47.8,0,0,0,176,184c0-44-42.09-69.79-43.88-70.86a8,8,0,0,0-8.24,0C122.09,114.21,80,140,80,184a47.8,47.8,0,0,0,2.73,15.93A71.88,71.88,0,0,1,56,176c0-34.41,12.06-71.56,34.85-107.43A205.85,205.85,0,0,1,128,33.64a205.85,205.85,0,0,1,37.15,34.93C187.94,104.44,200,141.59,200,176A71.88,71.88,0,0,1,173.27,199.93Z"/></svg>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="text-[#0c151d] font-medium text-sm">Compañía de Bomberos N° 28</h3>
                      <p class="text-[#4574a1] text-xs mt-1">Av. Benavides 400, Miraflores</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full">Abierto 24h</span>
                        <span class="text-xs text-[#4574a1]">1.8 km</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="p-4 hover:bg-[#f8fafc] cursor-pointer transition-colors" data-type="hospital">
                  <div class="flex items-start gap-3">
                    <div class="bg-purple-100 p-2 rounded-lg flex-shrink-0">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#a855f7" viewBox="0 0 256 256"><path d="M216,64H176V56a24,24,0,0,0-24-24H104A24,24,0,0,0,80,56v8H40A16,16,0,0,0,24,80V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V80A16,16,0,0,0,216,64ZM96,56a8,8,0,0,1,8-8h48a8,8,0,0,1,8,8v8H96ZM216,200H40V80H216V200Zm-56-64a8,8,0,0,1-8,8H136v16a8,8,0,0,1-16,0V144H104a8,8,0,0,1,0-16h16V112a8,8,0,0,1,16,0v16h16A8,8,0,0,1,160,136Z"/></svg>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="text-[#0c151d] font-medium text-sm">Clínica Ricardo Palma</h3>
                      <p class="text-[#4574a1] text-xs mt-1">Av. Javier Prado Este 1066, San Isidro</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full">Urgencias 24h</span>
                        <span class="text-xs text-[#4574a1]">2.1 km</span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="p-4 hover:bg-[#f8fafc] cursor-pointer transition-colors" data-type="policia">
                  <div class="flex items-start gap-3">
                    <div class="bg-blue-100 p-2 rounded-lg flex-shrink-0">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#3b82f6" viewBox="0 0 256 256"><path d="M223.68,66.15,135.68,18a15.88,15.88,0,0,0-15.36,0l-88,48.17a16,16,0,0,0-8.32,14v95.64a16,16,0,0,0,8.32,14l88,48.17a15.88,15.88,0,0,0,15.36,0l88-48.17a16,16,0,0,0,8.32-14V80.18A16,16,0,0,0,223.68,66.15ZM128,120,47.65,76,128,32l80.35,44Zm8,99.64V133.83l72-39.5v85.76Z"/></svg>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h3 class="text-[#0c151d] font-medium text-sm">Comisaría Miraflores</h3>
                      <p class="text-[#4574a1] text-xs mt-1">Calle Schell 250, Miraflores</p>
                      <div class="flex items-center gap-2 mt-2">
                        <span class="text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full">Abierto 24h</span>
                        <span class="text-xs text-[#4574a1]">2.5 km</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Map Area -->
            <div class="flex-1 relative">
              <div id="helpPointsMap" class="w-full h-full min-h-[600px]"></div>
              
              <!-- Legend -->
              <div class="absolute bottom-4 left-4 bg-white rounded-lg shadow-md p-4">
                <h4 class="text-[#0c151d] font-medium text-sm mb-3">Leyenda</h4>
                <div class="space-y-2">
                  <div class="flex items-center gap-2">
                    <div class="w-4 h-4 rounded-full bg-blue-500"></div>
                    <span class="text-[#0c151d] text-xs">Comisarías</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-4 h-4 rounded-full bg-green-500"></div>
                    <span class="text-[#0c151d] text-xs">Serenazgo</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-4 h-4 rounded-full bg-red-500"></div>
                    <span class="text-[#0c151d] text-xs">Bomberos</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <div class="w-4 h-4 rounded-full bg-purple-500"></div>
                    <span class="text-[#0c151d] text-xs">Hospitales</span>
                  </div>
                </div>
              </div>
              
              <!-- Emergency Numbers -->
              <div class="absolute top-4 right-4 bg-white rounded-lg shadow-md p-4">
                <h4 class="text-[#0c151d] font-medium text-sm mb-3">Números de Emergencia</h4>
                <div class="space-y-2">
                  <a href="tel:105" class="flex items-center gap-2 text-sm hover:bg-[#e6edf4] p-1 rounded transition-colors">
                    <span class="text-blue-500 font-bold">105</span>
                    <span class="text-[#4574a1]">Policía Nacional</span>
                  </a>
                  <a href="tel:116" class="flex items-center gap-2 text-sm hover:bg-[#e6edf4] p-1 rounded transition-colors">
                    <span class="text-red-500 font-bold">116</span>
                    <span class="text-[#4574a1]">Bomberos</span>
                  </a>
                  <a href="tel:106" class="flex items-center gap-2 text-sm hover:bg-[#e6edf4] p-1 rounded transition-colors">
                    <span class="text-purple-500 font-bold">106</span>
                    <span class="text-[#4574a1]">SAMU</span>
                  </a>
                </div>
              </div>
              
              <!-- Center on user location button -->
              <button onclick="centerOnUserLocation('helpPointsMap')" class="absolute bottom-4 right-4 w-12 h-12 bg-white rounded-full shadow-md flex items-center justify-center hover:bg-gray-50 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#359dff" viewBox="0 0 256 256"><path d="M128,64a40,40,0,1,0,40,40A40,40,0,0,0,128,64Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,128,128Zm0-112a88.1,88.1,0,0,0-88,88c0,31.4,14.51,64.68,42,96.25a254.19,254.19,0,0,0,41.45,38.3,8,8,0,0,0,9.18,0A254.19,254.19,0,0,0,174,200.25c27.45-31.57,42-64.85,42-96.25A88.1,88.1,0,0,0,128,16Zm0,206c-16.53-13-72-60.75-72-118a72,72,0,0,1,144,0C200,161.23,144.53,209,128,222Z"/></svg>
              </button>
            </div>
          </main>
        </div>
      </div>
    </div>

    <script src="../js/app.js"></script>
    <script src="../js/maps.js"></script>
    <script>
      // Require authentication
      auth.requireAuth();
      
      // Display user name
      const user = auth.getUser();
      if (user) {
        document.getElementById('userName').textContent = `Hola, ${user.fullName || user.email}`;
      }
      
      let helpPointsMapInstance = null;
      let activePointFilter = 'all';
      
      // Initialize map when page loads
      document.addEventListener('DOMContentLoaded', () => {
        helpPointsMapInstance = initHelpPointsMap('helpPointsMap');
      });
      
      function filterPoints(type) {
        activePointFilter = type;
        
        // Update button styles
        const types = ['all', 'policia', 'serenazgo', 'bomberos', 'hospital'];
        types.forEach(t => {
          const btn = document.getElementById(`btn${t.charAt(0).toUpperCase() + t.slice(1)}`);
          if (btn) {
            if (t === type) {
              btn.classList.remove('bg-[#e6edf4]', 'text-[#0c151d]');
              btn.classList.add('bg-[#0c151d]', 'text-white');
            } else {
              btn.classList.remove('bg-[#0c151d]', 'text-white');
              btn.classList.add('bg-[#e6edf4]', 'text-[#0c151d]');
            }
          }
        });
        
        // Filter list items
        const items = document.querySelectorAll('#pointsList > div');
        items.forEach(item => {
          if (type === 'all' || item.dataset.type === type) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
        
        // Update map markers
        if (helpPointsMapInstance) {
          loadHelpPoints(helpPointsMapInstance, type);
        }
      }
      
      // Search functionality
      document.getElementById('searchPoints').addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const items = document.querySelectorAll('#pointsList > div');
        
        items.forEach(item => {
          const text = item.textContent.toLowerCase();
          if (text.includes(query)) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
      });
    </script>
</body>
</html>
